```markdown
# 🎃 Pumpkin Price Prediction – Week 4 Lab Report  
> 基于美国南瓜市场公开数据的 多模型价格预测与可视化分析
本项目基于公开的 US-pumpkins.csv 数据集，采用多种回归模型（线性、多项式、多元线性、多元多项式）对美国南瓜价格进行建模与预测。
代码重点围绕 “bushel” 包装的南瓜，分析其价格随时间、品种、城市及包装规格的变动规律，并评估各模型的效果。



## 📁 项目结构
```
Week4/
├── main.py               
├── US-pumpkins.csv       
├── configuration.py
├── Data-Preprocessing.py
├── Visualization.py
├── Modeling&Evaluation.py
├── LGBM.py
├── XGBOOST.py
└── README.md
```

## 🧹 数据预处理
| 步骤 | 说明 |
|------|------|
| 筛选 | 仅保留 `Package` 列包含 **bushel** 的记录，排除其他计量单位。 |
| 特征构造 | 计算平均价格 `Price = (Low + High) / 2`。 |
| 日期处理 | 提取 `Month` 与 `DayOfYear`（一年中的第几天）。 |
| 包装换算 | 对 `1 1/9 bushel`、`1/2 bushel` 等特殊规格进行单位归一化。 |

---

## 📊 可视化速览
| 图表 | 重点发现 |
|------|----------|
| 价格 vs 年度日期散点图** | 价格随季节波动明显，呈倒 U 型。 |
| 月度均价柱状图 | 9 月均价最高（28.54 美元），12 月最低（约 15.41 美元）。 |
| 品种分色散点图 | `PIE TYPE` 与 `MINIATURE` 价格差异显著；后者普遍更贵。 |

---

## 🎯 线性模型结果一览
| 模型 | RMSE | MAE | R² | 备注 |
|------|------|-----|----|------|
| **简单线性回归**<br>`PIE TYPE ~ DayOfYear` | 2.356 (14.9 %) | – | 0.042 | 欠拟合，仅用日期解释力不足。 |
| **多项式回归**<br>`Price ~ Variety` (d=2) | 4.755 (18.1 %) | 3.211 | 0.791 | 仅用品种，表现尚可。 |
| **多元线性回归**<br>全部类别变量 | 2.84 (10.6 %) | – | 0.941 | 加入城市/月份/包装后显著提升。 |
| **多元多项式回归** (d=2) | **2.230 (8.3 %)** | – | **0.966** | 最佳效果 ⭐ |

## 🎯 树模型结果一览
| 模型 | RMSE | MAE | R² | 训练表现 |
|------|------|-----|----|----------|
| **XGBoost** | 19.26 | – | 0.9472 | `MAPE:1.46%` (最优性能) |
| **LightGBM** | 48.86 | – | 0.6599 | `MAPE:545.38%` |

## 🔍 关键洞察（补充树模型分析）
### 🌲 XGBoost 特征重要性
| 重要性类型 | Top 3 关键特征 |
|------------|----------------|
| **Weight** | ① Price_lag7 (769) <br> ② DayOfYear (762) <br> ③ Price_rolling_mean7 (704) |
| **Gain** | ① Price_rolling_mean7 (74,191) <br> ② Package (58,029) <br> ③ City (10,474) |
| **Cover** | ① Price_rolling_mean7 (262.4) <br> ② Package (223.9) <br> ③ Price_lag7 (120.8) |

### 💡 LightGBM 特征重要性（按增益）
1. **Package**：180,309,069.776（绝对主导特征）  
2. **City**：41,779,978.304  
3. **Variety**：65,164,512.650  
> 📌 最小影响力特征：Month (-352,460.388)

## 🔬 模型对比结论
1. **XGBoost 综合最优**  
   - 显著优于 LightGBM（R² 0.9472 vs 0.6599）
   - 价格时间序列特征（Price_lag7/DayOfYear）权重最高
   - 特征重要性分布均衡（时间、品类、地域均有贡献）

2. **关键特征一致性**  
   - 包装规格（Package）在所有模型中均居前三
   - 地域（City）和品种（Variety）持续高影响力
   - 季节性（Month/DayOfYear）需结合时间序列分析


## 🔍 关键洞察
- **多元多项式回归** 以 **8.3 % 的相对误差** 成为最优模型，R² 高达 0.966。  
- **城市**、**包装规格** 与 **品种** 对价格影响显著；**月份** 提供季节性信息。  
- 特征重要性（前 5 名）：  
  | 特征 | 系数 | 解释 |
  |------|------|------|
  | `var_MINIATURE` | **+4.67** | 该品种溢价最高 |
  | `var_MINIATURE^2` | **+4.67** | 多项式交互项 |
  | `var_PIE TYPE` | **–4.38** | 该品种价格偏低 |
  | `var_PIE TYPE^2` | **–4.38** | 多项式交互项 |
  | `var_MIXED HEIRLOOM VARIETIES` | **–3.40** | 混合品种价格中等 |

